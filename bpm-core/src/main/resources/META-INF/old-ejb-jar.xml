<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise
JavaBeans 2.0//EN" "http://java.sun.com/dtd/ejb-jar_2_0.dtd">

<ejb-jar>
	<display-name>Workflow - BPMEJB</display-name>
	<enterprise-beans>
		<session>
			<ejb-name>ejb/BPMEngineBean</ejb-name>
			<home>es.caib.bpm.beans.home.BPMEngineHome</home>
			<remote>es.caib.bpm.beans.remote.BPMEngine</remote>
			<ejb-class>es.caib.bpm.beans.BPMEngineBean</ejb-class>
			<session-type>Stateful</session-type>
			<transaction-type>Container</transaction-type>
			<security-role-ref>
				<description>servicios internos no autenticados</description>
				<role-name>BPM_INTERNAL</role-name>
				<role-link>BPM_INTERNAL</role-link>
			</security-role-ref>
			<security-role-ref>
				<role-name>tothom</role-name>
				<role-link>tothom</role-link>
			</security-role-ref>
			<resource-ref>
				<res-ref-name>jdbc/bpm</res-ref-name>
				<res-type>javax.sql.DataSource</res-type>
				<res-auth>Container</res-auth>
			</resource-ref>
		</session>
		<session>

			<ejb-name>ejb/BPMEngineBeanLocal</ejb-name>
			<local-home>
				es.caib.bpm.beans.home.BPMEngineLocalHome
			</local-home>
			<local>es.caib.bpm.beans.local.BPMEngineLocal</local>
			<ejb-class>es.caib.bpm.beans.BPMEngineBean</ejb-class>
			<session-type>Stateful</session-type>
			<transaction-type>Container</transaction-type>

			<security-role-ref>
				<description>servicios internos no autenticados</description>
				<role-name>BPM_INTERNAL</role-name>
				<role-link>BPM_INTERNAL</role-link>
			</security-role-ref>
			<security-role-ref>
				<role-name>tothom</role-name>
				<role-link>tothom</role-link>
			</security-role-ref>
			<resource-ref>
				<res-ref-name>jdbc/bpm</res-ref-name>
				<res-type>javax.sql.DataSource</res-type>
				<res-auth>Container</res-auth>
			</resource-ref>
		</session>
		<session>
			<ejb-name>ejb/BPMJobExecutorBeanLocal</ejb-name>
			<local-home>
				es.caib.bpm.beans.home.BPMJobExecutorLocalHome
			</local-home>
			<local>es.caib.bpm.beans.local.BPMJobExecutorLocal</local>
			<ejb-class>es.caib.bpm.beans.BPMJobExecutorBean</ejb-class>
			<session-type>Stateless</session-type>
			<transaction-type>Container</transaction-type>
			<resource-ref>
				<res-ref-name>jdbc/bpm</res-ref-name>
				<res-type>javax.sql.DataSource</res-type>
				<res-auth>Container</res-auth>
			</resource-ref>

            <security-identity>
                <run-as>
                    <description>Rol BPM_INTERNAL</description>
                    <role-name>BPM_INTERNAL</role-name>                    
                </run-as>
            </security-identity>
            
		</session>
		
				<session>
			<ejb-name>ejb/BPMConfigLocal</ejb-name>
			<local-home>es.caib.bpm.beans.home.BPMConfigLocalHome</local-home>
			<local>es.caib.bpm.beans.local.BPMConfigLocal</local>
			<ejb-class>es.caib.bpm.beans.BPMConfigBean</ejb-class>
			<session-type>Stateless</session-type>
			<transaction-type>Container</transaction-type>
			<security-role-ref>
				<description>servicios internos no autenticados</description>
				<role-name>BPM_INTERNAL</role-name>
				<role-link>BPM_INTERNAL</role-link>
			</security-role-ref>
			<security-role-ref>
				<role-name>tothom</role-name>
				<role-link>tothom</role-link>
			</security-role-ref>
			<resource-ref>
				<res-ref-name>jdbc/bpm</res-ref-name>
				<res-type>javax.sql.DataSource</res-type>
				<res-auth>Container</res-auth>
			</resource-ref>
			 
		</session>
		
		
		
	</enterprise-beans>

	<assembly-descriptor>
		<security-role>
			<description>servicios internos no autenticados</description>
			<role-name>BPM_INTERNAL</role-name>
		</security-role>

		<container-transaction>
			<method>
				<ejb-name>ejb/BPMEngineBean</ejb-name>
				<method-name>*</method-name>
			</method>
			<trans-attribute>Required</trans-attribute>
		</container-transaction>
		<container-transaction>
			<method>
				<ejb-name>ejb/BPMEngineBeanLocal</ejb-name>
				<method-name>*</method-name>
			</method>
			<trans-attribute>Required</trans-attribute>
		</container-transaction>
		<container-transaction>
			<method>
				<ejb-name>ejb/BPMJobExecutorBeanLocal</ejb-name>
				<method-name>*</method-name>
			</method>
			<trans-attribute>Required</trans-attribute>
		</container-transaction>


		<container-transaction>
			<method>
				<ejb-name>ejb/BPMConfigLocal</ejb-name>
				<method-name>*</method-name>
			</method>
			<trans-attribute>Required</trans-attribute>
		</container-transaction>

<!-- anonymous -->
		<method-permission>
			<unchecked />
			<method>
				<ejb-name>ejb/BPMConfigLocal</ejb-name>
				<method-name>*</method-name>
			</method>
		</method-permission>
		<method-permission>
			<role-name>tothom</role-name>
			<role-name>nobody</role-name>
			<role-name>BPM_INTERNAL</role-name>

			<method>
				<ejb-name>ejb/BPMEngineBeanLocal</ejb-name>
				<method-name>*</method-name>
			</method>

		</method-permission>

<!-- non anonymous -->
		<method-permission>
			<role-name>tothom</role-name>
			<role-name>BPM_INTERNAL</role-name>
			<method>
				<ejb-name>ejb/BPMEngineBean</ejb-name>
				<method-name>*</method-name>
			</method>
			<method>
				<ejb-name>ejb/BPMJobExecutorBeanLocal</ejb-name>
				<method-name>*</method-name>
			</method>
		</method-permission>
		
	</assembly-descriptor>



	<security-role>
		<description>servicios internos no autenticados</description>
		<role-name>BPM_INTERNAL</role-name>
		<role-link>BPM_INTERNAL</role-link>
	</security-role>
	<security-role>
		<description>usuario seycon</description>
		<role-name>tothom</role-name>
		<role-link>tothom</role-link>
	</security-role>
	<security-role>
		<description>usuario NO AUTENTICADO</description>
		<role-name>nobody</role-name>
		<role-link>nobody</role-link>
	</security-role>


</ejb-jar>
