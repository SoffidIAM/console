<?xml version="1.0" encoding="UTF-8"?>

<zkib-model>
	<datanode name="root">
		<finder name="usuari" type="usuari">
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService" method="getCurrentUsuari">
			</ejb-finder>
			<new-instance-bean
				className="es.caib.seycon.ng.comu.Usuari">
			</new-instance-bean>
		</finder>
		<finder name="moure" type="moure">  
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="findRoot" if="${!query}"/>
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="findEntryPoints" if="${query}">
				<parameter value="${queryName}"/>
			</ejb-finder>
			<new-instance-bean className="es.caib.seycon.ng.comu.PuntEntrada" />
		</finder>
	</datanode>
	
	<datanode name="usuari">
		<finder name="grup" type="void"> 
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="findUsuariGrupsByCodiUsuari">
			</ejb-finder>
		</finder>
		<finder name="rol" type="void"> 
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="findRolAccounts">
			</ejb-finder>
		</finder>
		<finder name="account" type="account">
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="getUserAccounts">
			</ejb-finder>
		</finder> 
		<finder name="dada" type="dada" executeOnNewObjects="true">  <!-- user:query -->
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="getUserAttributes">
			</ejb-finder>
			<new-instance-bean className="es.caib.seycon.ng.comu.DadaUsuari"> 
			</new-instance-bean>
		</finder>
	</datanode>
	
	<datanode name="moure">
	 	<finder name="moure" type="moure">  
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="findChildren">
				<parameter value="${instance}" />
			</ejb-finder>
		</finder> 	
	</datanode>
	
	<datanode name="account">
		<finder name="estatContrasenya" type="void">
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService" 
				method="passwordsStatus">
				<parameter value="${instance}"/>
			</ejb-finder>
		</finder>
		<finder name="dispatcherInformation" type="dispatcherInformation">
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService"
				method="getDispatcherInformation">
				<parameter value="${instance.dispatcher}"/>
			</ejb-finder>
		</finder>
		<finder name="owner" type="void">
			<ejb-finder jndi="soffid/ejb/es.caib.seycon.ng.servei.AccountService"
				method="getHPAccountOwner">
				<parameter value="${instance}"/>
			</ejb-finder>
		</finder>
	</datanode>
	
	<datanode name="void" />
	<datanode name="dispatcherInformation"/>

	<datanode name="dada">
		<script-handler>
			<update-script>
				if (instance.getCodiUsuari() == null)
					instance.setCodiUsuari (parent.instance.getCodi());
				obj = new com.soffid.web.users.additionalData.ShowAdditionalData();
				obj.checkRequiredAttribute(self); 
			</update-script>
		</script-handler>
		<ejb-handler jndi="soffid/ejb/es.caib.seycon.ng.servei.SelfService">
			<insert-method method="updateUserAttribute"  returnBean="true" > <!-- user:metadata:update -->
				<parameter value="${instance}" />
			</insert-method>
			<!--delete-method method="delete">  // NOTA: Ã©s un update 
				<parameter value="${instance}" />
			</delete-method-->
			<update-method method="updateUserAttribute"  returnBean="true"> <!-- user:metadata:update -->
				<parameter value="${instance}" />
			</update-method>
		</ejb-handler>
	</datanode>
	
</zkib-model>