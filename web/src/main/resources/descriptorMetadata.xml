<?xml version="1.0" encoding="UTF-8"?>

<zkib-model>
	<datanode name="root">		
		<finder name="customObject" type="objectType">
			<custom-finder className="com.soffid.iam.web.metadata.ObjectCustomFinder"/>
			<new-instance-bean className="com.soffid.iam.api.CustomObjectType">
			</new-instance-bean>
		</finder>
		<finder name="dataType" type="dataType">
			<script-finder>
				import es.caib.seycon.ng.comu.TypeEnumeration;
				list = new java.util.LinkedList();
//				list.add (new String(""));
				for (l: TypeEnumeration.literals())
				{
					list.add (l);
				}
				return list;
			</script-finder>
		</finder>
		<finder name="visibility" type="visibility">
			<script-finder>
				list = new java.util.LinkedList();
//				list.add (new String(""));
				for (l: com.soffid.iam.api.AttributeVisibilityEnum.literals())
				{
					list.add (l);
				}
				return list;
			</script-finder>
		</finder>
	</datanode>	
	
	<datanode name="objectType">
		<ejb-handler jndi="java:/module/AdditionalDataService-v2">
			<insert-method method="createCustomObjectType" returnBean="true">
				<parameter value="${instance}" />
			</insert-method>
			<delete-method method="deleteCustomObjectType">
				<parameter value="${instance}" />
			</delete-method>
			<update-method method="updateCustomObjectType">
				<parameter value="${instance}" />
			</update-method>
		</ejb-handler>
		<finder name="metadata" type="metadata">
			<custom-finder className="com.soffid.iam.web.metadata.MetadataCustomFinder"/>
			<new-instance-script>
				obj = new com.soffid.iam.api.DataType();
				obj.setValues ( new java.util.LinkedList());
				return obj;
			</new-instance-script>
		</finder>
		<validator>
			<attribute-validator expr="${instance.name}" notNull="true" friendlyName="com.soffid.iam.api.CustomObjectType.name"/>
			<attribute-validator expr="${instance.description}" notNull="true" friendlyName="com.soffid.iam.api.CustomObjectType.description"/>
		</validator>
	</datanode>
	
	<datanode name="metadata">
		<script-handler>
			<insert-script>
				instance.scope = parent.instance.scope;
				instance.objectType = parent.instance.name;
			</insert-script>
		</script-handler>
		<ejb-handler jndi="java:/module/AdditionalDataService-v2">
			<insert-method method="create" returnBean="true">
				<parameter value="${instance}" />
			</insert-method>
			<delete-method method="delete">
				<parameter value="${instance}" />
			</delete-method>
			<update-method method="update">
				<parameter value="${instance}" />
			</update-method>
		</ejb-handler>
		<custom-attribute name="typeDescription">
			return org.zkoss.util.resource.Labels.getLabel("typeDadaAddicional."+instance.type);
		</custom-attribute>
		<validator>
			<attribute-validator expr="${instance.name}" notNull="true" friendlyName="dadesAddicionals.CodiValidation"/>
		</validator>
	</datanode>
	
	<datanode name="dataType" transient="true">
		<custom-attribute name="literal">
			if (instance.length() == 0)
				return "";
			else
			 	return org.zkoss.util.resource.Labels.getLabel("typeDadaAddicional."+instance);
		</custom-attribute>
		<custom-attribute name="value">
			if (instance.length() == 0)
				return null;
			else
				return es.caib.seycon.ng.comu.TypeEnumeration.fromString(instance);
		</custom-attribute>
	</datanode>
	
	<datanode name="visibility" transient="true">
		<custom-attribute name="literal">
			if (instance.length() == 0)
				return "";
			else
			 	return org.zkoss.util.resource.Labels.getLabel("attributeVisibility."+instance);
		</custom-attribute>
		<custom-attribute name="value">
			if (instance.length() == 0)
				return null;
			else
				return com.soffid.iam.api.AttributeVisibilityEnum.fromString(instance);
		</custom-attribute>
	</datanode>
	
</zkib-model>
