<?xml version="1.0" encoding="UTF-8"?>

<zkib-model>
	<datanode name="root">
		<finder name="vault" type="vault">
			<ejb-finder jndi="java:/module/VaultService-v2"
				method="findVaultElementByText"  if="${id == null}">
				<parameter value="${textQuery}" />
			</ejb-finder>
			<ejb-finder jndi="java:/module/VaultService-v2"
				method="findVaultElement"  if="${id != null}">
				<parameter value="${id}"/>
			</ejb-finder>
			<new-instance-bean className="com.soffid.iam.api.VaultElement"/> 
		</finder>
		
	</datanode>
 

	<datanode name="vault"
		idProperty="id" parentProperty="parentId" childProperty="vault">
		<ejb-parent-loader jndi="java:/module/VaultService-v2" 
			method="findVaultElement">
			<parameter value="${instance.parentId}"/>
		</ejb-parent-loader>
		<ejb-handler jndi="java:/module/VaultService-v2">
			<insert-method method="create" returnBean="true" >  <!-- user:create -->
				<parameter value="${instance}"/>
			</insert-method>
			<delete-method method="remove">    
				<parameter value="${instance}" />
			</delete-method>
			<update-method method="update"> <!-- user:update -->
				<parameter value="${instance}" />
			</update-method>
		
		</ejb-handler>

		<finder name="vault" type="vault">  <!-- intranetMenus:query -->
			<ejb-finder jndi="java:/module/VaultService-v2"
				method="getChildren">
				<parameter value="${instance}" />
			</ejb-finder>
			<new-instance-bean className="com.soffid.iam.api.VaultElement"/> 
		</finder>
		
		<finder name="role" type="role" refreshAfterCommit="true"> <!-- user:role:query -->
			<ejb-finder jndi="java:/module/ApplicationService-v2"
				method="findRoleAccountByAccount"
				if="${instance.type=='account'}">
				<parameter value="${instance.id}"/>
			</ejb-finder>
			<new-instance-bean className="com.soffid.iam.api.RoleAccount"> 
			</new-instance-bean>
		</finder>
		<finder name="effectiveRole" type="effectiveRole" refreshAfterCommit="true"> <!-- user:role:query -->
			<ejb-finder jndi="java:/module/ApplicationService-v2"
				method="findRoleGrantHierarchyByAccount" 
				if="${instance.type=='account'}">
				<parameter value="${instance.id}"/>
			</ejb-finder>
		</finder>
		
		<finder name="services" type ="service">
			<ejb-finder jndi="java:/module/AccountService-v2"
				method="findAccountServices"
				if="${instance.type=='account'}">
				<parameter value="${instance.account}"/>
			</ejb-finder>
		</finder>

	</datanode>

	<datanode name="folder2">
		<finder name="folder2" type="folder2">  <!-- intranetMenus:query -->
			<ejb-finder jndi="java:/module/VaultService-v2"
				method="getChildren">
				<parameter value="${instance}" />
			</ejb-finder>
		</finder>
	</datanode>

	<datanode name="effectiveRole" transient="true"/>

	<datanode name="role">
		<ejb-handler jndi="java:/module/ApplicationService-v2">
			<insert-method method="create" returnBean="true" > <!-- user:role:create -->
				<parameter value="${instance}"/>
			</insert-method>
			<delete-method method="delete" >  <!-- user:role:delete -->
				<parameter value="${instance}" />
			</delete-method>
			<update-method method="update"> 
				<parameter value="${instance}" />
			</update-method>
		</ejb-handler>
		<finder name="holderGroupData" type="group" refreshAfterCommit="true"> <!-- user:role:query -->
			<ejb-finder jndi="java:/module/GroupService-v2"
				method="findGroupByName" if="${canQueryUser &amp;&amp; instance.holderGroup != null}">
				<parameter value="${instance.holderGroup}" />
			</ejb-finder>
		</finder>
	</datanode>
	
	<datanode name="service" transient="true">
	</datanode>
	
	<datanode name="tipusUsuari">
	</datanode>
	


</zkib-model>
